# ğŸ“Š NTILE() em SQL â€” SegmentaÃ§Ã£o em grupos (quartis, quintis, decis)

**NTILE(n)** Ã© uma *window function* que **divide os registros em `n` grupos** com tamanhos **aproximadamente iguais**, de acordo com uma ordenaÃ§Ã£o (ranking).  
Ã‰ perfeita para criar **faixas de performance** (top, mÃ©dio, baixo) sem precisar calcular percentis na mÃ£o.

---

## âœ… Caso prÃ¡tico: vendedores em quartis de performance
A ideia Ã© classificar vendedores em **4 grupos (quartis)** com base em `unidades_vendidas`:

- **Q1 (1Âº quartil)** â†’ top 25% (melhores)
- **Q4 (4Âº quartil)** â†’ bottom 25% (piores)

> ObservaÃ§Ã£o: o nÃºmero retornado pelo `NTILE(4)` Ã© **1 a 4** (onde **1 Ã© o melhor grupo**, porque estamos ordenando **DESC**).

---

## ğŸ” Como funciona
Exemplo:

- `NTILE(4)` â†’ divide em 4 grupos  
- `ORDER BY unidades_vendidas DESC` â†’ define o ranking do maior para o menor  
- `PARTITION BY ano` â†’ cria os grupos **separadamente por ano** (nÃ£o mistura 2024 com 2025, por exemplo)

---

## ğŸ§  Exemplos rÃ¡pidos
- `NTILE(2)` â†’ 2 grupos (top 50% vs bottom 50%)
- `NTILE(4)` â†’ quartis (bem comum)
- `NTILE(10)` â†’ decis (mais detalhado)

---

## ğŸ¯ AplicaÃ§Ãµes comuns
- âœ… SegmentaÃ§Ã£o de clientes (A/B/C/D)
- âœ… Curva ABC (produtos/receita/volume)
- âœ… Identificar **top performers** e **low performers**
- âœ… AnÃ¡lises por faixas (percentis/quartis) em dashboards

---

## âš ï¸ Cuidados e dicas
- Se houver **empates** em `unidades_vendidas`, a divisÃ£o ainda acontece, mas pessoas com o mesmo valor podem cair em grupos diferentes (normal em NTILE).
- Se vocÃª quiser segmentar **o geral**, remova o `PARTITION BY ano`.
- Para nomes mais amigÃ¡veis (ex.: "Top 25%"), vocÃª pode criar um `CASE` em cima do quartil.

---

## ğŸ§¾ Query (exatamente como no exemplo)
```sql
SELECT
    ano,
    funcionario,
    unidades_vendidas,
    NTILE(4) OVER (
        PARTITION BY ano
        ORDER BY unidades_vendidas DESC
    ) AS quartil_performance
FROM cap12.vendas;
